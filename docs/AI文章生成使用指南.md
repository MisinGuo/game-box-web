# AI 文章生成 - 系统集成使用指南

> 版本：v2.5.0  
> 日期：2025-12-14  
> 📚 本指南说明如何在管理后台配置 AI 文章自动生成系统

---

## 系统架构概述

AI 文章生成系统通过以下流程工作：

1. **用户在管理后台**连接 GitHub 账号
2. **Fork 公共仓库** `game-box-ai-generator` 到自己的账号
3. **配置 API Keys**（AI 平台、图片搜索）
4. **配置图片池**（自定义图片资源）
5. **设置定时任务**（如每天凌晨 2 点）
6. **系统自动触发** GitHub Action 执行生成任务
7. **文章自动发布**到仓库并触发网站部署

```
┌──────────────┐    ┌──────────────┐    ┌──────────────┐
│  管理后台     │───▶│  后端服务     │───▶│ GitHub API   │
└──────────────┘    └──────────────┘    └──────────────┘
                           │                    │
                           │                    ▼
                           │            ┌──────────────┐
                           │            │GitHub Action │
                           │            └──────────────┘
                           │                    │
                           ▼                    ▼
                    ┌──────────────┐    ┌──────────────┐
                    │ Webhook回调   │◀───│ AI 平台/图片  │
                    └──────────────┘    └──────────────┘
```

---

## 快速开始

### 步骤 1：连接 GitHub 账号

1. 进入 **管理后台** → **系统设置** → **GitHub 集成**
2. 点击 **连接 GitHub 账号**
3. 在弹出的 GitHub 授权页面中点击 **Authorize**
4. 授权成功后返回管理后台

### 步骤 2：Fork 公共仓库

1. 在 **GitHub 集成** 页面点击 **Fork 生成器仓库**
2. 系统自动将 `game-box-ai-generator` Fork 到您的账号
3. 等待 Fork 完成（约 10 秒）

### 步骤 3：配置 AI 平台 API Key

1. 进入 **AI 配置** → **API 密钥管理**
2. 选择您使用的 AI 平台：

| AI 平台 | 获取方式 | 推荐指数 |
|---------|---------|---------|
| DeepSeek | [platform.deepseek.com](https://platform.deepseek.com/) | ⭐⭐⭐⭐⭐ 性价比最高 |
| OpenAI | [platform.openai.com](https://platform.openai.com/api-keys) | ⭐⭐⭐⭐ 效果好 |
| Claude | [console.anthropic.com](https://console.anthropic.com/) | ⭐⭐⭐⭐ 效果好 |
| 通义千问 | [dashscope.console.aliyun.com](https://dashscope.console.aliyun.com/) | ⭐⭐⭐ 国内访问快 |

3. 输入 API Key 并点击 **保存**
4. 系统自动将 API Key 同步到您的 GitHub 仓库 Secrets

### 步骤 4：配置图片服务（可选但推荐）

#### 4.1 配置图片搜索引擎

1. 进入 **AI 配置** → **图片服务**
2. 选择图片搜索引擎：

| 搜索引擎 | 免费额度 | 图片质量 | 推荐场景 |
|---------|---------|---------|---------|
| Unsplash | 50次/小时 | ⭐⭐⭐⭐⭐ | 通用图片、风景 |
| Pixabay | 5000次/小时 | ⭐⭐⭐⭐ | 通用图片 |
| Bing | 1000次/月 | ⭐⭐⭐ | 游戏截图搜索 |

3. 获取并输入 API Key
4. 点击 **测试连接** 确认配置正确

#### 4.2 配置自定义图片池

1. 进入 **AI 配置** → **图片池管理**
2. 创建图片分类（如：`banner`、`screenshot`、`character`）
3. 上传图片或批量导入图片 URL
4. 保存配置

### 步骤 5：创建提示词模板

1. 进入 **AI 配置** → **提示词模板**
2. 点击 **新建模板**
3. 填写模板信息：

```text
---
name: 游戏介绍模板
type: game-intro
---

# {gameName}破解版下载

{IMAGE_SEARCH:{gameName}游戏截图}

## 游戏简介

请为{gameName}写一段200字的游戏简介，包含：
- 游戏类型
- 核心玩法
- 游戏特色

## 精彩截图

{IMAGE_SEARCH:{gameName}:3}

## 破解版特性

请列出5个破解版特性，如无限元宝、满VIP等

## 下载说明

{IMAGE_POOL:download-guide}

点击下方按钮立即下载！
```

### 步骤 6：配置定时任务

1. 进入 **AI 配置** → **定时任务**
2. 点击 **新建任务**
3. 配置任务参数：

| 配置项 | 说明 | 示例 |
|-------|------|------|
| 任务名称 | 任务描述 | 每日游戏文章生成 |
| 执行时间 | Cron 表达式 | `0 0 2 * * ?`（每天凌晨2点） |
| AI 平台 | 使用的 AI | DeepSeek |
| 模板 | 使用的模板 | 游戏介绍模板 |
| 游戏列表 | 要生成的游戏 | 剑来, 传奇世界, 三国志 |
| 输出目录 | 文章保存位置 | src/docs/pojie |

4. 点击 **保存并启用**

---

## 批量生成多篇文章

系统支持一次配置多篇文章，并通过定时任务自动执行批量生成。

### 创建批量任务

1. 进入 **AI 配置** → **批量任务**
2. 点击 **新建批量任务**
3. 有两种配置方式：

#### 方式一：可视化添加

点击 **添加文章** 逐个配置：

| 字段 | 说明 | 示例 |
|-----|------|------|
| 游戏名称 | 文章主题 | 剑来 |
| 游戏分类 | 输出目录分类 | xianxia |
| 模板 | 使用的模板 | game-intro |
| AI 平台 | 覆盖默认平台（可选） | claude |
| 自定义提示词 | 特殊要求（可选） | 重点介绍修炼体系 |
| 关键词 | SEO 关键词 | 仙侠,修仙,剑修 |
| 图片设置 | 是否启用、搜索引擎 | 启用 / Unsplash |

#### 方式二：JSON 批量导入

点击 **导入 JSON** 上传配置文件：

```json
{
  "tasks": [
    {
      "gameName": "剑来",
      "category": "xianxia",
      "template": "game-intro",
      "customPrompt": "请重点介绍游戏的仙侠世界观和修炼体系",
      "keywords": "仙侠,修仙,剑修,玄幻",
      "imageEnabled": true,
      "imageEngine": "unsplash"
    },
    {
      "gameName": "传奇世界",
      "category": "chuanqi",
      "template": "game-intro",
      "customPrompt": "突出游戏的经典传奇玩法和 PK 系统",
      "keywords": "传奇,PK,攻沙,热血"
    },
    {
      "gameName": "原神",
      "category": "erciyuan",
      "template": "game-intro",
      "aiProvider": "claude",
      "keywords": "二次元,开放世界,角色,冒险"
    }
  ],
  "options": {
    "aiProvider": "deepseek",
    "imageSearchEnabled": true,
    "imageSearchEngine": "unsplash",
    "maxConcurrent": 2
  }
}
```

### 配置批量任务调度

1. 创建完批量任务后，配置执行方式：

| 执行方式 | 说明 |
|---------|------|
| **立即执行** | 保存后马上触发 GitHub Action |
| **定时执行** | 设置 Cron 表达式，按计划执行 |
| **周期执行** | 每日/每周固定时间执行 |

2. Cron 表达式示例：

| Cron 表达式 | 说明 |
|------------|------|
| `0 0 2 * * ?` | 每天凌晨 2:00 |
| `0 0 10 ? * MON` | 每周一上午 10:00 |
| `0 0 */6 * * ?` | 每 6 小时执行一次 |
| `0 0 2 1 * ?` | 每月 1 号凌晨 2:00 |

### 批量任务执行监控

1. 进入 **AI 配置** → **任务监控**
2. 查看批量任务状态：

| 状态字段 | 说明 |
|---------|------|
| 任务状态 | 等待中 / 执行中 / 已完成 / 部分失败 |
| 总文章数 | 批量任务包含的文章总数 |
| 已完成 | 成功生成的文章数量 |
| 失败 | 生成失败的文章数量 |
| 开始时间 | 任务开始执行时间 |
| 预计完成 | 根据进度估算完成时间 |

3. 点击任务可查看每篇文章的详细状态
4. 失败的文章可单独重试

### 批量任务 Webhook 回调

系统会在以下时机发送回调通知：

| 回调事件 | 时机 | 用途 |
|---------|------|------|
| `article_complete` | 每篇文章生成完成 | 更新单篇状态 |
| `batch_complete` | 整个批量任务完成 | 汇总通知、触发后续流程 |
| `article_failed` | 单篇文章生成失败 | 告警、记录错误 |

---

## 图片占位符语法

在模板中使用以下占位符自动插入图片：

### 图片搜索（自动从搜索引擎获取）

```text
搜索并插入 1 张图片
{IMAGE_SEARCH:剑来游戏截图}

搜索并随机选取 3 张图片
{IMAGE_SEARCH:仙侠游戏:3}

使用变量作为搜索关键词
{IMAGE_SEARCH:{gameName}游戏截图}
```

### 图片池（从自定义图片库选取）

```text
从 banner 分类随机选 1 张
{IMAGE_POOL:banner}

从 screenshot 分类随机选 3 张
{IMAGE_POOL:screenshot:3}
```

### 固定图片

```text
使用固定 URL
{IMAGE:https://cdn.example.com/logo.png}
```

---

## 手动触发生成

除了定时任务，您也可以手动触发生成：

1. 进入 **AI 配置** → **文章生成**
2. 选择模板和 AI 平台
3. 输入游戏名称和分类
4. 点击 **立即生成**
5. 查看生成进度和结果

---

## 生成记录与统计

### 查看生成历史

进入 **AI 配置** → **生成记录**，可查看：

- 生成时间
- 游戏名称
- 使用的模板和 AI
- Token 消耗
- 处理的图片数量
- 生成状态

### 统计分析

进入 **数据统计** → **AI 生成统计**，可查看：

- 日/周/月生成数量
- 各 AI 平台使用量
- Token 消耗趋势
- 生成成功率

---

## 常见问题

### Q: GitHub 授权失败怎么办？

1. 检查是否有代理/VPN 影响
2. 尝试清除浏览器缓存
3. 使用无痕模式重试

### Q: API Key 配置后无法使用？

1. 确认 API Key 是否有效
2. 点击 **测试连接** 验证
3. 检查账户余额是否充足

### Q: 图片搜索没有结果？

1. 尝试更换搜索关键词
2. 检查图片搜索 API 配额
3. 设置备用图片 URL

### Q: 生成的文章没有自动发布？

1. 检查 GitHub 仓库写入权限
2. 查看 Action 执行日志
3. 确认 Webhook 回调是否成功

---

## API 参考

### 触发生成 API

```bash
POST /api/ai-generate/trigger
Content-Type: application/json
Authorization: Bearer <token>

{
  "templateId": 1,
  "gameName": "剑来",
  "category": "xianxia",
  "aiProvider": "deepseek",
  "imageConfig": {
    "searchEnabled": true,
    "searchEngine": "unsplash",
    "uploadEnabled": true
  }
}
```

### 查询生成状态 API

```bash
GET /api/ai-generate/status/{taskId}
Authorization: Bearer <token>
```

---

## 版本更新

| 版本 | 日期 | 更新内容 |
|------|------|---------|
| v1.0.0 | 2025-12-14 | 初始版本 |
| v1.1.0 | 2025-12-14 | 新增图片搜索和图片池功能 |
| v1.2.0 | 2025-12-14 | 系统集成优化，支持管理后台配置 |
| v1.3.0 | 2025-12-14 | 新增批量生成多篇文章功能，支持定时任务调度 |
| v2.5.0 | 2025-12-14 | 与主文档版本同步，完善监控和回调机制 |
